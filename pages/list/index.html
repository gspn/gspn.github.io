<h2>The List</h2>
<p>
	This is not one of those lists that insist on making sense. Pff!<br>
	Place tags [listed, between, square_brackets] before the query. Said query will try to match all words in any order.
</p>

<div>
	<input type="text">
	<input type="checkbox" id="showtags"><label for="showtags">show tags</label>
	<input type="checkbox" id="showinvis"><label for="showinvis">show system pages</label>
	<button>filter</button>
</div>

<br>
<hr>

<ul class="arlist"></ul>

<script type="module">
	import pages from "/pages/0.js";
	const listPages = async function ({ query, showtags, showinvis }) {
		// get element references
		const list = document.querySelector(".arlist");

		const lowerQuery = query === null ? query : query.toLowerCase();

		// filtering the entries
		const matches = (function () {
			// invisibles
			let matches = showinvis
				? Object.entries(pages)
				: Object.entries(pages).filter(([key, page]) => !page.tags.includes("invis"))

			// matching
			matches = query === null
				? matches
				: matches.filter(([key, page]) => {
					const lowerItem = page.toLowerCase();

					const words = lowerQuery.split(' ');

					// Check if all words in the query are present in the item (in any order)
					return words.every(word => lowerItem.includes(word));

					//TODO add tag filtering
				});

			return matches;
		})();

		// displaying the list
		matches.forEach(([key, entry]) => {
			list.insertAdjacentHTML('beforeend', `<li><a href="/pages/${key}/">${entry.name}</a></li>`);
		});
	};
	listPages({ query: null, showinvis: false });
</script>